# 機能仕様書: RSS記事キュレーションBot

**機能ブランチ**: `001-rss-article-curator`  
**作成日**: 2025-10-27  
**ステータス**: ドラフト  
**入力**: ユーザー説明: "目的: 複数の技術ブログRSSフィーダーまとめサイトを監視し、ユーザーの興味（あらかじめ定義した技術スタックやトピック）に合う記事を毎日3件または5件ピックアップして、Discordに通知するボットを作成したい。"

## ユーザーシナリオ & テスト *(必須)*

### ユーザーストーリー 1 - 毎日のキュレーション記事通知 (優先度: P1)

特定の技術に興味がある開発者として、複数のRSSまとめサイトを手動で閲覧することなく、最新情報を把握できるように、毎日3〜5件の関連技術記事のダイジェストをDiscordで受け取りたい。

**この優先度の理由**: これが中核的な価値提案である。自動化されたパーソナライズされた記事発見。これがなければ、ボットの存在意義がない。

**独立テスト**: RSSフィードソースと興味トピックを設定し、毎日の実行をトリガーして、Discordが要約と推薦付きの正確に3〜5件の記事を受信することを確認する。

**受入シナリオ**:

1. **前提**: ボットが午前9時に設定されたRSSソースとユーザーの興味で実行される、**条件**: 興味に一致する新しい記事が見つかった、**結果**: Discordが3〜5件の記事の通知を受信し、各記事に要約があり、最も価値のある記事を強調する全体的な推薦がある
2. **前提**: 一致する記事が3件未満存在する、**条件**: ボットが実行される、**結果**: Discordは利用可能な一致記事のみ（1〜2件）を受信し、一致が限定的であることを示すメモがある
3. **前提**: 一致する記事が5件以上存在する、**条件**: ボットが実行される、**結果**: ボットは興味の一致度に基づいて最も関連性の高い上位5件の記事を選択する
4. **前提**: 新しい一致記事が見つからない、**条件**: ボットが実行される、**結果**: Discordが「今日はあなたの興味に一致する新しい記事はありません」という通知を受信する

---

### ユーザーストーリー 2 - 設定可能な興味管理 (優先度: P2)

ボット管理者として、時間の経過とともに変化する技術的興味に適応できるように、ボットを再デプロイせずに興味トピックとタグのリストを更新したい。

**この優先度の理由**: 柔軟性は長期的な価値にとって重要だが、ボットは最初は静的な設定で機能できる。

**独立テスト**: 興味設定ファイル（GitHubまたは外部ストレージ）を更新し、ボット実行をトリガーして、コード変更や再デプロイなしに記事選択が新しい興味を反映することを確認する。

**受入シナリオ**:

1. **前提**: ["Go", "Kubernetes"]の興味を持つ既存の設定ファイルがある、**条件**: 管理者がそれを["Rust", "WebAssembly"]に更新する、**結果**: 次のボット実行で新しい興味に一致する記事が選択される
2. **前提**: ボット実行中に設定ファイルが更新される、**条件**: 次の予定実行が発生する、**結果**: ボットは再起動なしに最新の設定を読み込む
3. **前提**: 無効な設定ファイル形式がある、**条件**: ボットがそれを読み込もうとする、**結果**: ボットはエラーをログに記録し、以前の有効な設定を使用し続ける

---

### ユーザーストーリー 3 - 設定可能なRSSソース管理 (優先度: P2)

ボット管理者として、新しい発見ソースを含めたり、信頼性の低いソースを削除したりできるように、コードを変更せずにRSSフィードまとめサイトのソースを追加または削除したい。

**この優先度の理由**: ソースの柔軟性はボットの有用性を拡張するが、最初は2〜3のソースの固定リストで許容できる。

**独立テスト**: 設定に新しいRSSソースURLを追加し、ボット実行をトリガーして、新しいソースからの記事がDiscord通知に表示されることを確認する。

**受入シナリオ**:

1. **前提**: 2つのRSSまとめサイトを持つ既存のソースリストがある、**条件**: 管理者が3番目のソースURLを追加する、**結果**: 次のボット実行で3つすべてのソースからの記事が含まれる
2. **前提**: 1つのRSSソースが利用不可能またはエラーを返す、**条件**: ボットが実行される、**結果**: ボットは他のソースの処理を続行し、停止せずに失敗をログに記録する
3. **前提**: 設定からソースURLが削除される、**条件**: ボットが実行される、**結果**: そのソースからの記事は今後の通知に表示されなくなる

---

### ユーザーストーリー 4 - 記事の重複排除 (優先度: P1)

Discordユーザーとして、毎日のダイジェストに新鮮で未読のコンテンツのみが含まれるように、同じ記事を複数回見ることを避けたい。

**この優先度の理由**: ユーザー体験にとって重要 - 重複通知は信頼と価値を損なう。

**独立テスト**: ボットに記事を一度通知させ、その後、RSSフィードにまだ存在していても、同じ記事が後続の実行に表示されないことを確認する。

**受入シナリオ**:

1. **前提**: 記事が1日目にDiscordに通知された、**条件**: ボットが2日目に実行され、同じ記事に遭遇する、**結果**: 記事は通知から除外される
2. **前提**: 記事がLLMによって1日目に「興味がない」と評価された、**条件**: ボットが2日目に実行され、同じ記事に遭遇する、**結果**: 記事はLLMによって再評価されない
3. **前提**: 重複排除履歴に10,000件以上の記事が含まれている、**条件**: ボットが重複をチェックする、**結果**: ルックアップは2秒以内に完了する

---

### エッジケース

- RSSフィードまとめサイトが一時的にダウンまたはHTTPエラーを返す場合はどうなりますか？
- 記事コンテンツを取得できない場合（ペイウォール、404、タイムアウト）はどうなりますか？
- LLM APIレート制限が実行中に超過された場合はどうなりますか？
- Discord webhookが利用不可能またはレート制限された場合はどうなりますか？
- 記事コンテンツが英語以外の言語である場合はどうなりますか？
- RSSフィードに不正なXMLまたは必須フィールドが欠落している場合はどうなりますか？
- 複数の記事が同じタイトルだが異なるURLを持つ場合はどうなりますか？
- 記事URLが別のドメインにリダイレクトされる場合はどうなりますか？
- ボットが同じ日に複数回実行される場合（偶発的なトリガー）はどうなりますか？
- システムクロックが正しくない場合、スケジュールの不整合を引き起こす場合はどうなりますか？

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムは毎日午前9時頃に2〜3の設定されたまとめサイトからRSSフィードを取得しなければならない
- **FR-002**: システムはRSSフィードで見つかったURLから完全な記事コンテンツを取得しなければならない
- **FR-003**: システムはLLMを使用して、設定された興味トピック/タグに対する各記事の関連性を評価しなければならない
- **FR-004**: システムはLLM評価スコアに基づいて最も関連性の高い3〜5件の記事を選択しなければならない
- **FR-005**: システムはLLMを使用して選択された各記事の要約を生成しなければならない
- **FR-006**: システムは最も価値のある記事を示す全体的な推薦を生成しなければならない
- **FR-007**: システムは選択された記事、要約、推薦を含む通知をDiscordに送信しなければならない
- **FR-008**: システムは重複通知を防ぐために通知された記事の履歴を永続化しなければならない
- **FR-009**: システムは再評価を避けるために「興味がない」と評価された記事の履歴を永続化しなければならない
- **FR-010**: システムは外部設定（GitHubファイルなど）からRSSソースURLを読み込まなければならない
- **FR-011**: システムは外部設定（GitHubファイルなど）から興味トピック/タグを読み込まなければならない
- **FR-012**: システムはLLM APIレート制限（分単位および日単位のクォータ）を尊重しなければならない
- **FR-013**: システムは指数バックオフで一時停止して再試行することでLLMレート制限エラーを処理しなければならない
- **FR-014**: システムは1つのRSSソースが失敗した場合でも残りのソースの処理を続行しなければならない
- **FR-015**: システムはデバッグのためにすべてのエラー（RSS取得失敗、記事コンテンツ失敗、LLMエラー、Discordエラー）をログに記録しなければならない
- **FR-016**: システムは完全な実行（取得、評価、通知）を[要明確化: タイムリミットが指定されていない - 30分？1時間？制限なし？]以内に完了しなければならない
- **FR-017**: システムはLLM評価の前にURLで重複記事を識別しなければならない
- **FR-018**: システムはコンテンツ取得が失敗した記事を優雅にスキップして処理しなければならない

### 主要エンティティ

- **RSSソース**: 監視するRSSフィードまとめサイトのURL。属性にはURL、オプションの名前/ラベル、有効/無効ステータスが含まれる。
- **興味トピック**: 記事のフィルタリングに使用される技術タグまたはトピックキーワード。属性にはトピック名、オプションのエイリアス、一致優先度（高/中/低）が含まれる。
- **記事**: RSSフィードから発見された技術ブログ投稿。属性にはタイトル、URL、公開日、ソースRSSフィード、完全なコンテンツテキスト、取得タイムスタンプが含まれる。
- **記事評価**: LLM分析の結果。属性には記事参照、関連性スコア（0〜100）、一致トピック、生成された要約、評価タイムスタンプが含まれる。
- **通知履歴**: Discordに送信された記事の記録。属性には記事URL、通知日、Discord メッセージIDが含まれる。
- **却下履歴**: 興味がないと判断された記事の記録。属性には記事URL、評価日、理由（トピック不一致、低関連性スコア）が含まれる。

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは毎日午前9時±15分にDiscordで正確に3〜5件のキュレーション記事を受信する
- **SC-002**: 30日間連続の運用で記事の重複通知がゼロ件発生する
- **SC-003**: 通知された記事の少なくとも80%がユーザーによって「関連性がある」または「非常に関連性がある」と評価される（Discordリアクションまたはフィードバックメカニズムで測定）
- **SC-004**: システムはRSSソースから100件以上の記事を処理し、1時間以内に評価を完了する
- **SC-005**: LLM APIコストは通常の運用中に1日あたり5米ドル未満に維持される（毎日100〜200件の記事を評価すると仮定）
- **SC-006**: ボットは手動介入なしに一時的なRSSソース障害から正常に回復する
- **SC-007**: 設定の更新（興味またはソース）はボットの再起動なしに24時間以内に有効になる
- **SC-008**: 管理者は設定ファイルを編集することで5分未満で新しいRSSソースを追加できる

## 前提条件

### 技術的前提

- RSSまとめサイトは記事URLを含む標準的なRSS 2.0またはAtomフィードを提供する
- 記事コンテンツは少なくとも70%の確率で公開アクセス可能である（ペイウォールの後ろにない）
- LLM APIは日本語および英語のコンテンツ評価をサポートする
- Discord webhook APIが利用可能で、フォーマットされたメッセージペイロードを受け入れる
- 外部設定ストレージ（GitHub）は認証付きのHTTPS経由でアクセス可能である

### ビジネス前提

- 毎日のダイジェスト頻度（午前9時に1日1回）はユーザーのニーズに十分である
- 1日3〜5件の記事は、ユーザーを圧倒することなく十分な価値を提供する
- LLM評価の品質は記事の関連性スコアリングに許容できる（人間のレビューなし）
- 1日あたり5ドル未満の運用コストは予算制約内である
- 単一のDiscordチャネル/webhook宛先で十分である（当初はマルチチャネルサポートは不要）

### スコープの境界

- **スコープ内**: RSSフィード監視、LLMベースの記事評価、Discord通知、重複排除、外部設定管理
- **スコープ外**: 多言語UI（ボットは現在英語/日本語のみ）、カスタムLLMファインチューニング、Discordボットコマンド経由のユーザーフィードバック収集、記事のアーカイブ/検索、マルチチャネルDiscordサポート、リアルタイム通知（予定された毎日の実行のみ）

## 必要な明確化

**CLR-001**: 完全実行のタイムリミット - ボットはタイムアウトを強制すべきか？提案: レート制限にヒットした場合やソースが遅い場合の無限ハングを防ぐために最大1時間。

**理由**: LLMレート制限により、100件以上の記事の処理には大幅な時間がかかる可能性がある。徹底性と運用上の制約のバランスを取るために、許容可能な処理期間を定義する必要がある。
